#!/bin/bash

##Notes
#	Remember to implement the lowpri queue in this script.

#SBATCH --account=uio
#SBATCH --time=2:0:0
#SBATCH --mem-per-cpu=2G

source /cluster/bin/jobsetup

module purge	# clear any inherited modules
set -o errexit	# exit on errors

module load fsl/5.0.9	# Will load FSL in ABEL (check using module avail).

source $FSLDIR/etc/fslconf/fsl.sh

DATASET="MNI152_T1_2mm_brain.nii.gz fmri.nii.gz 3DRR_brain.nii.gz checker.txt firstFEAT.fsf"
OUTFILE=$SCRATCH/$TASK_ID.feat

cp $DATASET $SCRATCH
cd $SCRATCH
chkfile $OUTFILE

mkdir $OUTFILE
ls > $OUTFILE/data.txt
echo "SCRATCH=$SCRATCH OUTFILE=$OUTFILE TASK_ID=$TASK_ID" > $OUTFILE/variables.txt

sed -ie "s|OUTFILE|${OUTFILE}|g" firstFEAT.fsf
sed -ie "s|SCRATCH|${SCRATCH}|g" firstFEAT.fsf

cp firstFEAT.fsf $OUTFILE

feat firstFEAT.fsf

